# コード品質改善計画

## 実施日時
2025-01-04 13:52

## 現状分析

### 1. テスト状況
- **ユニットテスト**: 137/138 成功（1件失敗）
  - `test_mock_manager.py::test_unified_search` - MockSearchResultの初期化エラー
- **統合テスト**: 全35件がエラー
  - Neo4j/PostgreSQLサービスが利用不可能
  - Docker環境が必要

### 2. Ruffエラー（5件）
- A004: `ConnectionError`がPython組み込み名をシャドウイング（3件）
- A001: クラス名`ConnectionError`がPython組み込み名をシャドウイング（1件）
- E501: 行が長すぎる（2件）

### 3. Mypyエラー（多数）
- 型アノテーション不足
- 引数の型不一致（特にPostgreSQLのexecuteメソッド）
- Noneチェック不足
- 戻り値の型不一致

## 改善項目

### 優先度: 高

#### 1. MockSearchResultのバグ修正
- `src/graph_postgres_manager/mocks/manager.py:375`
- 初期化パラメータの不一致を修正

#### 2. ConnectionErrorの名前変更
- `GraphConnectionError`に変更してシャドウイングを回避
- 影響ファイル:
  - `exceptions.py`
  - `__init__.py`
  - `connections/base.py`

#### 3. 長い行の修正
- `mocks/manager.py:662, 690`の行分割

### 優先度: 中

#### 4. PostgreSQL executeメソッドの型修正
- パラメータをtupleからlistに変更
- 影響ファイル多数（metadata/, intent/manager.py等）

#### 5. Noneチェックの追加
- Optional型の適切な処理
- 特にconnection関連のメソッド

### 優先度: 低

#### 6. 型アノテーションの追加
- 変数への型アノテーション追加
- 戻り値の型一致確認

## 実装順序

1. MockSearchResultのバグ修正（即座に対応）
2. ConnectionError名前変更（影響範囲大だが単純）
3. 長い行の修正（簡単）
4. PostgreSQL executeの型修正（影響範囲大）
5. その他の型エラー修正

## 統合テストについて

統合テストはDocker環境（Neo4j/PostgreSQL）が必要なため、現環境では実行不可。
開発環境でのDocker起動後に再テストが必要。

## 次のアクション

上記の改善を順次実施し、コード品質を向上させる。