# APIドキュメント生成とコード品質改善計画

## 概要
graph_postgres_managerライブラリの成熟度向上のため、APIドキュメントの自動生成環境構築とコード品質の継続的改善を実施する。

## 現状分析

### コード品質の状況
- Ruffエラー: 191件（466件から58%削減済み）
- テスト成功率: 97.1%（138テスト中134成功）
- 主な問題:
  - 例外名にErrorサフィックスが必要
  - インポート順序と未使用インポートの整理
  - 相対インポートから絶対インポートへの変換
  - 行が長すぎるエラー（E501）

### ドキュメントの状況
- APIドキュメント: 未生成
- 使用例: 基本的なモック使用例のみ
- チュートリアル: 未作成
- 利用者の学習コストが高い状態

## 実施計画

### Phase 1: APIドキュメント生成環境構築（優先度: 最高）

#### 1.1 Sphinx環境のセットアップ
- [ ] Sphinxと関連パッケージのインストール
  - sphinx
  - sphinx-autodoc-typehints
  - sphinx-rtd-theme
  - myst-parser（Markdown対応）
- [ ] docs/ディレクトリ構造の作成
  - source/
  - build/
  - _static/
  - _templates/
- [ ] conf.py設定ファイルの作成
  - 自動ドキュメント生成設定
  - 型ヒント情報の抽出設定
  - テーマ設定

#### 1.2 APIドキュメントの生成
- [ ] 全Public APIのdocstring確認・改善
  - GraphPostgresManagerクラス
  - 各種Managerクラス（IntentManager、SearchManager等）
  - 公開メソッドのパラメータ・戻り値説明
- [ ] Sphinxによる自動生成実行
- [ ] 生成されたドキュメントのレビュー・修正

#### 1.3 GitHub Pagesでの公開
- [ ] GitHub Pages用のブランチ設定
- [ ] GitHub Actionsワークフローの作成
  - ドキュメント自動ビルド
  - gh-pagesブランチへのデプロイ
- [ ] カスタムドメイン設定（必要に応じて）

### Phase 2: コード品質改善（優先度: 高）

#### 2.1 Ruffエラーの修正（191件）
- [ ] 自動修正可能なエラーの一括修正
  ```bash
  ruff check --fix src/ tests/
  ```
- [ ] 例外クラス名の修正
  - GraphPostgresManagerException → GraphPostgresManagerError
  - 他の例外クラスも同様に修正
- [ ] インポート関連の修正
  - isort設定による自動整理
  - 未使用インポートの削除
  - 相対インポートを絶対インポートに変換

#### 2.2 複雑メソッドのリファクタリング
- [ ] store_ast_graphメソッドの分割（153行）
  - バリデーション処理の分離
  - バッチ処理ロジックの抽出
  - Neo4jクエリ生成の独立化
- [ ] _validate_ast_graphメソッドの簡素化
  - 個別バリデーション関数への分割
  - エラーメッセージの改善

#### 2.3 テスト失敗の修正（4件）
- [ ] 失敗しているテストの原因調査
- [ ] テストコードまたは実装の修正
- [ ] 新しいテストケースの追加（必要に応じて）

### Phase 3: 使用例・チュートリアル作成（優先度: 中）

#### 3.1 実践的なサンプルコード
- [ ] examples/ディレクトリの拡充
  - 基本的な使用例
  - ast2graph連携例
  - intent_store連携例
  - 統合検索の使用例
- [ ] エラーハンドリングのベストプラクティス
- [ ] パフォーマンスチューニングガイド

#### 3.2 チュートリアル作成
- [ ] クイックスタートガイド
- [ ] 段階的な機能紹介
- [ ] トラブルシューティングガイド
- [ ] FAQ集

## 成功指標
- APIドキュメントカバレッジ: 100%
- Ruffエラー: 0件
- テスト成功率: 100%
- GitHub Pagesでのドキュメント公開
- 5つ以上の実践的なサンプルコード

## タイムライン
- Phase 1: 2日間
- Phase 2: 2日間
- Phase 3: 1日間

## 期待効果
- 学習コスト: 50%削減（ドキュメント充実により）
- 開発効率: 30%向上（コード品質改善により）
- コミュニティ採用率の向上

## 次のステップ
1. Sphinx環境のセットアップから開始
2. 並行してRuffエラーの自動修正を実行
3. APIドキュメント生成とコード品質改善を交互に進める