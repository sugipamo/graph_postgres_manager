# 統合整備計画 - 優先順位と実行順序の明確化

## 作成日時
2025年7月4日 18:00

## 背景
現在の計画ファイルには以下の問題があることが判明：
1. 優先順位の不整合（ROADMAPとの乖離）
2. 重複する計画の存在
3. 未解決の緊急問題
4. 実装状況の記載の矛盾

## 現状の整理

### 緊急度別の未解決問題

#### 🔴 緊急（24時間以内）
1. **GitHub Actions統合テスト失敗**
   - フィクスチャ名の不整合（_event_loop、_clean_postgres等）
   - 影響：CIパイプラインが機能不全
   - 解決時間：30分

2. **MockSearchResultのバグ**
   - 初期化パラメータの不一致
   - 影響：ユニットテスト1件失敗
   - 解決時間：15分

3. **ConnectionErrorのシャドウイング**
   - Python組み込み名との衝突
   - 影響：Ruffエラー4件
   - 解決時間：30分

#### 🟡 重要（1週間以内）
1. **Ruffエラー修正（残り5件）**
   - 長すぎる行（2件）
   - 上記のシャドウイング（3件）
   - 解決時間：1時間

2. **PostgreSQL executeメソッドの型修正**
   - tuple→listへの変更
   - 影響：Mypyエラー多数
   - 解決時間：2時間

#### 🟢 計画的実施（2週間以内）
1. **APIドキュメント生成（Phase 5.1）**
   - Sphinx環境構築
   - 自動生成設定
   - GitHub Pages公開

2. **複雑メソッドのリファクタリング**
   - store_ast_graphメソッドの分割
   - バッチ処理ロジックの抽出

## 実行計画（t-wada推奨形式）

### Step 1: 緊急問題の解決（Day 1）
```bash
# 1.1 統合テストのフィクスチャ修正
# tests/integration/conftest.py:147
# _event_loop → event_loop
# _clean_postgres → clean_postgres
# _clean_neo4j → clean_neo4j

# 1.2 MockSearchResultのバグ修正
# src/graph_postgres_manager/mocks/manager.py:375

# 1.3 ConnectionError → GraphConnectionError
# src/graph_postgres_manager/exceptions.py
# 影響箇所の一括置換
```

### Step 2: コード品質の基本改善（Day 2）
```bash
# 2.1 Ruffエラーの完全解消
# - 長い行の分割
# - シャドウイング解消の確認

# 2.2 基本的な型エラーの修正
# - PostgreSQL executeメソッド
# - Noneチェックの追加
```

### Step 3: APIドキュメント基盤構築（Day 3-5）
```bash
# 3.1 Sphinx初期設定
# - sphinx-quickstart実行
# - docs/ディレクトリ構成
# - conf.py設定

# 3.2 自動生成環境
# - autodoc設定
# - GitHub Actions設定
# - 初回ビルドテスト
```

### Step 4: ドキュメント内容充実（Day 6-10）
```bash
# 4.1 APIリファレンス
# - 全Public APIのdocstring改善
# - モジュール別RST作成

# 4.2 使用例とチュートリアル
# - クイックスタート
# - 実践的サンプル（5件以上）
```

## 成功基準
1. **緊急問題**：全て解決、CI/CDグリーン
2. **コード品質**：Ruffエラー0件、Mypyエラー大幅削減
3. **ドキュメント**：Sphinx自動生成稼働、GitHub Pages公開
4. **テスト**：ユニットテスト100%成功

## リスクと対策
1. **統合テスト環境**
   - リスク：Docker環境依存で完全テスト不可
   - 対策：モック実装でのテストカバレッジ確保

2. **型エラーの波及**
   - リスク：executeメソッド修正の影響大
   - 対策：段階的修正、テスト確認の徹底

## 次のアクション
1. この統合計画に基づいて緊急問題から順次対応
2. 各ステップ完了時に進捗を記録
3. 完了した計画は結果フォルダへ移動

## 備考
- ROADMAPの優先順位に従い、APIドキュメント生成を最優先事項とする
- ただし、CI/CD修復は開発効率に直結するため最初に実施
- t-wadaの推奨形式：明確なステップ、具体的なコマンド、テスト可能な成功基準